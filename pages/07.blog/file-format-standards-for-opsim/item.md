---
title: 'File format standards for OpSim'
published: false
date: '18-04-2016 00:00'
publish_date: '18-04-2016 00:00'
metadata:
    author: admin
taxonomy:
    category:
        - General
visible: true
summary:
    enabled: '1'
    format: short
    size: 128
author: admin
---

OpSim is a complicated piece of software that uses all sorts of different data to interact with each other as can be seen in the following graph. Next to application settings, there is also a model and physical properties library and simulation case data. The model library consists of python scripts that can be loaded by OpSim on demand which create specific data structures in memory which, once referenced can be saved and loaded from and to the simulation case file.

The physical properties library loads it’s parameters from a SQLite database on request and caches all references parameters in the data structure. Once referenced, this data can be saved to the simulation case file.

Application data is stored

 

The current OpSim in trunk does not yet have a file format for its simulation cases. It does however come with support for FireBird databases to store application settings as well as physical properties data. While FireBird is a mature database system and it allows to do SQL queries on the data, it does however add dependencies to the application which can be problematic for some users. Additionally it potentially adds more issues with a correct working of the application, especially as the application is built for different platforms. Next to that a database seems to be overkill for the task that is required. Currently it has not yet been possible to setup a working FireBase connection to the OpSim version in trunk.

For this reason a new file format has been worked on. The advantages of such a new format is that it will be

- cross-platform as it is programmed in native FPC
- tight integration with the internal data structure
- fast, as there is no unneeded overhead
- not depending on upstream versions
- easily adjustable and expandable by the development team

**Type of file formats**  
 There are different types of file formats possible for OpSim. One might thing of XML, INI or some other format that is reasonably readable by humans. However the downside of these kind of formats is that they are pretty large and can get very complex for (de)serialization. Also, because they need to be serialized they are slow in reading and writing. I have always failed to see why people would want such a file format, unless the files are very small or can be generated by an external application or script. Instead the most favorable type of file format seems to be a for of binary file. This type of file formats allow for very fast reading from and writing to, because the internal structure is of less relevance to the end user.

**IFF file format**  
 The most fitting file format is chosen to be a binary IFF format specification. IFF stands for XXX and essentially is nothing more that a container for multiple data structures. The file first stores a header that identifies the file and some general variables. Next all data is written to the file exactly the same as it is stored in memory. In the end the list of data structure elements is stored to the file so when the file is read from, the application can identify each data.

**DNA**  
 The DNA of the file is a special structure that allows to decode the file data stored. The nice thing about this DNA is that only supported variables are read from and written to the file. This means that the file is also backwards and forwards compatible. The DNA is created on compilation of the application by a tool called makesdna. This tool reads a number of source files from disk, parses them and decides which of the data structures declared in the sources need to be added to the DNA list. Once stored in the DNA list this data will be saved to the file.

**Application settings vs. simulation case**  
 The file format allows to store all the data in OpSim. This means that application settings (such as layout of the ISE but also ) and simulation cases can be stored in the same file. This can be useful when sharing a project file and being able to recreate all data structures from the file, even one that holds custom scripts or properties.